# BIST_NEW í”„ë¡œì íŠ¸ ìƒì„¸ ê¸°ìˆ  ë¬¸ì„œ

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ìƒì„¸](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜-ìƒì„¸)
2. [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ìƒì„¸](#ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„-ìƒì„¸)
3. [ì¸ì¦ ì‹œìŠ¤í…œ ìƒì„¸](#ì¸ì¦-ì‹œìŠ¤í…œ-ìƒì„¸)
4. [ë©”ë‰´ ì‹œìŠ¤í…œ ìƒì„¸](#ë©”ë‰´-ì‹œìŠ¤í…œ-ìƒì„¸)
5. [í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ ìƒì„¸](#í”„ë¡ íŠ¸ì—”ë“œ-ì»´í¬ë„ŒíŠ¸-ìƒì„¸)
6. [API ì„¤ê³„ ìƒì„¸](#api-ì„¤ê³„-ìƒì„¸)
7. [ì„±ëŠ¥ ìµœì í™”](#ì„±ëŠ¥-ìµœì í™”)
8. [ë³´ì•ˆ êµ¬í˜„ ìƒì„¸](#ë³´ì•ˆ-êµ¬í˜„-ìƒì„¸)
9. [í…ŒìŠ¤íŠ¸ ì „ëµ](#í…ŒìŠ¤íŠ¸-ì „ëµ)
10. [ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…](#ëª¨ë‹ˆí„°ë§-ë°-ë¡œê¹…)

---

## ğŸ— ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ìƒì„¸

### ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì„±ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BIST_NEW ì‹œìŠ¤í…œ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Frontend Layer (Next.js 14)                                â”‚
â”‚  â”œâ”€â”€ App Router (File-based Routing)                       â”‚
â”‚  â”œâ”€â”€ React Server Components                                â”‚
â”‚  â”œâ”€â”€ Client Components                                      â”‚
â”‚  â”œâ”€â”€ State Management (Context API)                        â”‚
â”‚  â””â”€â”€ UI Framework (Tailwind CSS + AG Grid)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Backend Layer (NestJS 11)                                  â”‚
â”‚  â”œâ”€â”€ Module System                                          â”‚
â”‚  â”œâ”€â”€ Dependency Injection                                   â”‚
â”‚  â”œâ”€â”€ Guards & Interceptors                                  â”‚
â”‚  â”œâ”€â”€ Validation (class-validator)                          â”‚
â”‚  â””â”€â”€ Documentation (Swagger)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Data Access Layer                                          â”‚
â”‚  â”œâ”€â”€ TypeORM (ORM)                                         â”‚
â”‚  â”œâ”€â”€ Oracle Database Driver                                â”‚
â”‚  â”œâ”€â”€ Connection Pooling                                    â”‚
â”‚  â””â”€â”€ Stored Procedure Execution                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Database Layer (Oracle)                                    â”‚
â”‚  â”œâ”€â”€ BISBM Schema                                          â”‚
â”‚  â”œâ”€â”€ User Tables                                           â”‚
â”‚  â”œâ”€â”€ Menu Tables                                           â”‚
â”‚  â”œâ”€â”€ Business Logic Tables                                 â”‚
â”‚  â””â”€â”€ Stored Procedures                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ëª¨ë“ˆë³„ ì˜ì¡´ì„± ê´€ê³„

```
AppModule
â”œâ”€â”€ ConfigModule (í™˜ê²½ ì„¤ì •)
â”œâ”€â”€ TypeOrmModule (ë°ì´í„°ë² ì´ìŠ¤)
â”œâ”€â”€ AuthModule (ì¸ì¦)
â”‚   â”œâ”€â”€ AuthController
â”‚   â””â”€â”€ AuthService
â”œâ”€â”€ UserModule (ì‚¬ìš©ì ê´€ë¦¬)
â”‚   â”œâ”€â”€ UserController
â”‚   â””â”€â”€ UserService
â”œâ”€â”€ MenuModule (ë©”ë‰´ ê´€ë¦¬)
â”‚   â”œâ”€â”€ MenuController
â”‚   â””â”€â”€ MenuService
â”œâ”€â”€ DatabaseModule (ë°ì´í„°ë² ì´ìŠ¤)
â”‚   â””â”€â”€ OracleService
â””â”€â”€ SysModule (ì‹œìŠ¤í…œ ê´€ë¦¬)
```

---

## ğŸ—„ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ìƒì„¸

### Oracle ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì •

```typescript
// database/database.provider.ts
@Injectable()
export class OracleService implements OnModuleInit, OnModuleDestroy {
	private pool: oracledb.Pool | null = null

	async onModuleInit() {
		this.pool = await oracledb.createPool({
			user: process.env.DB_USER,
			password: process.env.DB_PASSWORD,
			connectString: `${process.env.DB_HOST}:${process.env.DB_PORT}/${process.env.DB_SERVICE}`,
			poolMin: 2, // ìµœì†Œ ì—°ê²° ìˆ˜
			poolMax: 10, // ìµœëŒ€ ì—°ê²° ìˆ˜
			poolIncrement: 1, // ì—°ê²° ì¦ê°€ ë‹¨ìœ„
		})
	}
}
```

### í”„ë¡œì‹œì € ì‹¤í–‰ íŒ¨í„´

```typescript
async executeProcedure(procedureName: string, params: any[] = []): Promise<any> {
  const connection = await this.getConnection();

  // ì¡°íšŒ í”„ë¡œì‹œì €ì™€ ìˆ˜ì • í”„ë¡œì‹œì € êµ¬ë¶„
  const isSelectProc = procedureName.endsWith('_S');

  const bindVars: any = {
    o_result: {
      type: isSelectProc ? oracledb.CURSOR : oracledb.STRING,
      dir: oracledb.BIND_OUT
    },
  };

  // íŒŒë¼ë¯¸í„° ë°”ì¸ë”©
  params.forEach((param, i) => {
    bindVars[`p${i + 1}`] = param;
  });

  const result = await connection.execute(
    `BEGIN ${procedureName}(:o_result${params.length > 0 ? ', ' + params.map((_, i) => `:p${i + 1}`).join(', ') : ''}); END;`,
    bindVars,
    { outFormat: oracledb.OUT_FORMAT_OBJECT }
  );
}
```

### ì£¼ìš” í…Œì´ë¸” êµ¬ì¡° ìƒì„¸

#### ì‚¬ìš©ì ê´€ë¦¬ í…Œì´ë¸”

```sql
-- ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´
CREATE TABLE TBL_USER_INF (
  USER_ID VARCHAR2(10) PRIMARY KEY,           -- ì‚¬ìš©ì ID
  USER_NM VARCHAR2(20),                       -- ì‚¬ìš©ìëª…
  DEPT_CD VARCHAR2(20),                       -- ë¶€ì„œ ì½”ë“œ
  DUTY_CD VARCHAR2(4),                        -- ì§ì±… ì½”ë“œ
  DUTY_DIV_CD VARCHAR2(4),                    -- ì§ì±… êµ¬ë¶„ ì½”ë“œ
  AUTH_CD VARCHAR2(10),                       -- ê¶Œí•œ ì½”ë“œ
  WRK01_USE_YN CHAR(1),                       -- ì—…ë¬´1 ì‚¬ìš© ì—¬ë¶€
  WRK02_USE_YN CHAR(1),                       -- ì—…ë¬´2 ì‚¬ìš© ì—¬ë¶€
  APV_APOF_ID VARCHAR2(10),                   -- ìŠ¹ì¸ ë‹´ë‹¹ì ID
  USER_PWD VARCHAR2(20),                      -- ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸
  PWD_CHNG_DTTM VARCHAR2(14),                 -- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¼ì‹œ
  EMAIL_ADDR VARCHAR2(100),                   -- ì´ë©”ì¼ ì£¼ì†Œ
  USR_ROLE_ID VARCHAR2(20)                    -- ì‚¬ìš©ì ì—­í•  ID
);

-- ì‚¬ìš©ì ì—­í•  ì •ë³´
CREATE TABLE TBL_USER_ROLE (
  USR_ROLE_ID VARCHAR2(20) PRIMARY KEY,       -- ì—­í•  ID
  USR_ROLE_NM VARCHAR2(50),                   -- ì—­í• ëª…
  USR_ROLE_DESC VARCHAR2(200),                -- ì—­í•  ì„¤ëª…
  USR_ROLE_USE_YN CHAR(1),                    -- ì—­í•  ì‚¬ìš© ì—¬ë¶€
  REG_DTTM VARCHAR2(14),                      -- ë“±ë¡ ì¼ì‹œ
  CHNG_DTTM VARCHAR2(14)                      -- ë³€ê²½ ì¼ì‹œ
);
```

#### ë©”ë‰´ ê´€ë¦¬ í…Œì´ë¸”

```sql
-- ë©”ë‰´ ì •ë³´
CREATE TABLE TBL_MENU_INF (
  MENU_ID VARCHAR2(20) PRIMARY KEY,           -- ë©”ë‰´ ID
  MENU_NM VARCHAR2(50),                       -- ë©”ë‰´ëª…
  MENU_URL VARCHAR2(200),                     -- ë©”ë‰´ URL
  UPPR_MENU_ID VARCHAR2(20),                  -- ìƒìœ„ ë©”ë‰´ ID
  MENU_LVL NUMBER(2),                         -- ë©”ë‰´ ë ˆë²¨
  MENU_ORD NUMBER(3),                         -- ë©”ë‰´ ìˆœì„œ
  MENU_USE_YN CHAR(1),                        -- ë©”ë‰´ ì‚¬ìš© ì—¬ë¶€
  REG_DTTM VARCHAR2(14),                      -- ë“±ë¡ ì¼ì‹œ
  CHNG_DTTM VARCHAR2(14)                      -- ë³€ê²½ ì¼ì‹œ
);

-- í”„ë¡œê·¸ë¨ ì •ë³´
CREATE TABLE TBL_PGM_INF (
  PGM_ID VARCHAR2(20) PRIMARY KEY,            -- í”„ë¡œê·¸ë¨ ID
  PGM_NM VARCHAR2(50),                        -- í”„ë¡œê·¸ë¨ëª…
  PGM_URL VARCHAR2(200),                      -- í”„ë¡œê·¸ë¨ URL
  PGM_DESC VARCHAR2(200),                     -- í”„ë¡œê·¸ë¨ ì„¤ëª…
  PGM_USE_YN CHAR(1),                         -- í”„ë¡œê·¸ë¨ ì‚¬ìš© ì—¬ë¶€
  REG_DTTM VARCHAR2(14),                      -- ë“±ë¡ ì¼ì‹œ
  CHNG_DTTM VARCHAR2(14)                      -- ë³€ê²½ ì¼ì‹œ
);
```

---

## ğŸ” ì¸ì¦ ì‹œìŠ¤í…œ ìƒì„¸

### ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦ í”Œë¡œìš°

```typescript
// 1. ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤
@Post('login')
async login(@Body() body: { empNo: string; password: string }, @Req() req: RequestWithSession) {
  // 1. ì‚¬ìš©ì ì¡´ì¬ í™•ì¸
  const userExists = await this.userService.userExists(empNo);

  // 2. ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
  const isPasswordValid = await this.userService.validateUserPassword(empNo, password);

  // 3. ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
  const userInfo = await this.userService.findUserWithDept(empNo);

  // 4. ë©”ë‰´ ë° í”„ë¡œê·¸ë¨ ê¶Œí•œ ì¡°íšŒ
  const menuList = await this.menuService.getMenuListByRole(userInfo.usrRoleId);
  const programList = await this.programService.getProgramListByRole(userInfo.usrRoleId);

  // 5. ì„¸ì…˜ì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
  req.session.user = {
    ...userInfo,
    menuList,
    programList,
  };
}
```

### í”„ë¡ íŠ¸ì—”ë“œ ì¸ì¦ ìƒíƒœ ê´€ë¦¬

```typescript
// modules/auth/hooks/useAuth.ts
export function AuthProvider({ children }: { children: React.ReactNode }) {
	const [user, setUser] = useState<User | null>(null)
	const [loading, setLoading] = useState(true)

	// ì„¸ì…˜ í™•ì¸
	const checkSession = async () => {
		try {
			const data = await AuthService.checkSession()
			if (data.success && data.user) {
				const userInfo: User = {
					userId: data.user.userId,
					empNo: data.user.empNo,
					name: data.user.userName,
					email: data.user.emailAddr,
					department: data.user.deptNm,
					position: data.user.dutyNm,
					role: data.user.authCd === '30' ? 'ADMIN' : 'USER',
					permissions: data.user.permissions,
					menuList: data.user.menuList,
					programList: data.user.programList,
				}
				setUser(userInfo)
			}
		} catch (error) {
			setUser(null)
		} finally {
			setLoading(false)
		}
	}
}
```

### ê¶Œí•œ ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC)

```typescript
// ê¶Œí•œ í™•ì¸ ë¡œì§
const checkPermission = (user: User, requiredPermission: string): boolean => {
	// ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
	if (user.role === 'ADMIN') return true

	// íŠ¹ì • ê¶Œí•œ í™•ì¸
	return user.permissions.includes(requiredPermission)
}

// ë©”ë‰´ ê¶Œí•œ í™•ì¸
const hasMenuAccess = (user: User, menuId: string): boolean => {
	return user.menuList.some((menu: any) => menu.MENU_ID === menuId)
}
```

---

## ğŸ“‹ ë©”ë‰´ ì‹œìŠ¤í…œ ìƒì„¸

### ë©”ë‰´ íŠ¸ë¦¬ êµ¬ì¡°

```typescript
// ë©”ë‰´ ë°ì´í„° êµ¬ì¡°
interface MenuItem {
	menuSeq: string // ë©”ë‰´ ìˆœì„œ
	menuDspNm: string // ë©”ë‰´ í‘œì‹œëª…
	pgmId: string // í”„ë¡œê·¸ë¨ ID
	menuShpDvcd: string // ë©”ë‰´ í˜•íƒœ êµ¬ë¶„ ì½”ë“œ
	hgrkMenuSeq: string // ìƒìœ„ ë©”ë‰´ ìˆœì„œ
	flag: string // í”Œë˜ê·¸
	menuUseYn: string // ë©”ë‰´ ì‚¬ìš© ì—¬ë¶€
	menuLvl: number // ë©”ë‰´ ë ˆë²¨
	mapTitle: string // ë§µ íƒ€ì´í‹€
	menuPath: string // ë©”ë‰´ ê²½ë¡œ
}
```

### ë©”ë‰´ ë Œë”ë§ ë¡œì§

```typescript
// mainframe/COM0000M00.tsx
const handleMenuClick = (pgmId: string) => {
	// 1. ë©”ë‰´ ì •ë³´ í™•ì¸
	const menu = (session.user?.menuList || []).find(
		(m: any) => m.PGM_ID === pgmId
	)

	// 2. í”„ë¡œê·¸ë¨ ì •ë³´ í™•ì¸
	const program = (session.user?.programList || []).find(
		(p: any) => p.PGM_ID === pgmId
	)

	// 3. íƒ­ ì¤‘ë³µ í™•ì¸
	if (tabs.some((tab) => tab.programId === pgmId)) {
		setActiveTab(pgmId)
		return
	}

	// 4. íƒ­ ê°œìˆ˜ ì œí•œ (ìµœëŒ€ 5ê°œ)
	if (tabs.length >= 5) {
		setToast({
			message: 'ìµœëŒ€ 5ê°œì˜ í™”ë©´ë§Œ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
			type: 'warning',
			isVisible: true,
		})
		return
	}

	// 5. ìƒˆ íƒ­ ì¶”ê°€
	const newTab: TabItem = {
		programId: pgmId,
		title: program.PGM_NM,
		menuPath: program.LINK_PATH,
	}
	setTabs((prev) => [...prev, newTab])
	setActiveTab(pgmId)
}
```

### ë™ì  ì»´í¬ë„ŒíŠ¸ ë¡œë”©

```typescript
// ContentFrame.tsx
const ContentFrame = ({ programId, title, menuPath }: ContentFrameProps) => {
  const [Component, setComponent] = useState<React.ComponentType | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const loadComponent = async () => {
      try {
        setLoading(true);
        setError(null);

        // ë™ì  ì„í¬íŠ¸ë¡œ ì»´í¬ë„ŒíŠ¸ ë¡œë”©
        const module = await import(`../${menuPath}`);
        setComponent(() => module.default);
      } catch (err) {
        setError('ì»´í¬ë„ŒíŠ¸ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        console.error('Component load error:', err);
      } finally {
        setLoading(false);
      }
    };

    if (menuPath) {
      loadComponent();
    }
  }, [menuPath]);

  if (loading) return <div>ë¡œë”© ì¤‘...</div>;
  if (error) return <div>ì—ëŸ¬: {error}</div>;
  if (!Component) return <div>ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>;

  return <Component />;
};
```

---

## ğŸ¨ í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ ìƒì„¸

### ë©”ì¸í”„ë ˆì„ ë ˆì´ì•„ì›ƒ êµ¬ì¡°

```typescript
// COM0000M00.tsx - ë©”ì¸í”„ë ˆì„ ì»´í¬ë„ŒíŠ¸
export default function COM0000M00() {
  const { user, session, logout, isAuthenticated } = useAuth();
  const [showMenuTree, setShowMenuTree] = useState(false);
  const [menuTreeLocked, setMenuTreeLocked] = useState(false);
  const [tabs, setTabs] = useState<TabItem[]>([]);
  const [activeTab, setActiveTab] = useState<string>('');

  return (
    <div className='w-screen h-screen flex flex-col overflow-hidden'>
      {/* ìƒë‹¨ í—¤ë” */}
      <TopFrame
        userName={user?.name}
        userTeam={user?.department}
        userPosition={user?.position}
        userEmpNo={user?.empNo}
      />

      {/* í•˜ë‹¨ ë³¸ë¬¸ ì˜ì—­ */}
      <div className='flex flex-1 min-h-0 relative'>
        {/* ì¢Œì¸¡ ì•„ì´ì½˜ë°” */}
        <div className='z-30'>
          <LeftFrame
            onMenuClick={() => setShowMenuTree((v) => !v)}
            onLogout={handleLogout}
          />
        </div>

        {/* ì½˜í…ì¸  ì˜ì—­ */}
        <div className='flex-1 flex relative'>
          {/* ë©”ë‰´íŠ¸ë¦¬ (ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜) */}
          <div className={`absolute left-0 top-0 h-full w-[300px] bg-[#e5e5e5] transition-transform duration-300 z-20 ${
            showMenuTree ? 'translate-x-0' : '-translate-x-full'
          }`}>
            <MenuTree
              menuList={mappedMenuList}
              onMenuClick={handleMenuClick}
              onLockChange={handleLockChange}
            />
          </div>

          {/* ì‹¤ì œ ì½˜í…ì¸  */}
          <div className={`flex-1 flex flex-col transition-all duration-300 ${
            showMenuTree ? 'ml-[300px]' : 'ml-0'
          }`}>
            {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
            <Maintab
              tabs={tabs}
              activeTab={activeTab}
              onTabClick={handleTabClick}
              onTabClose={handleTabClose}
            />

            {/* í˜ì´ì§€ íƒ€ì´í‹€ */}
            <PageTitle
              title={tabs.find(tab => tab.programId === activeTab)?.title}
              programId={activeTab}
              onClose={() => handleTabClose(activeTab)}
            />

            {/* ì½˜í…ì¸  í”„ë ˆì„ */}
            <ContentFrame
              programId={activeTab}
              title={tabs.find(tab => tab.programId === activeTab)?.title}
              menuPath={tabs.find(tab => tab.programId === activeTab)?.menuPath}
            />
          </div>
        </div>
      </div>
    </div>
  );
}
```

### ì¸ì¦ ê°€ë“œ ì»´í¬ë„ŒíŠ¸

```typescript
// mainframe/page.tsx - ì¸ì¦ ê°€ë“œ
export default function MainframePage() {
  const { isAuthenticated, loading } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (!loading && !isAuthenticated) {
      router.push('/signin');
    }
  }, [loading, isAuthenticated, router]);

  if (loading || !isAuthenticated) {
    return (
      <div className='min-h-screen flex items-center justify-center'>
        <div className='flex items-center space-x-2'>
          <svg className='animate-spin h-8 w-8 text-blue-600' /* ... */ />
          <span className='text-gray-600'>ë¡œë”© ì¤‘...</span>
        </div>
      </div>
    );
  }

  return <COM0000M00 />;
}
```

### í† ìŠ¤íŠ¸ ì•Œë¦¼ ì‹œìŠ¤í…œ

```typescript
// components/Toast.tsx
interface ToastProps {
  message: string;
  type: 'info' | 'warning' | 'error';
  isVisible: boolean;
  onClose: () => void;
}

export default function Toast({ message, type, isVisible, onClose }: ToastProps) {
  useEffect(() => {
    if (isVisible) {
      const timer = setTimeout(() => {
        onClose();
      }, 3000);
      return () => clearTimeout(timer);
    }
  }, [isVisible, onClose]);

  if (!isVisible) return null;

  const bgColor = {
    info: 'bg-blue-500',
    warning: 'bg-yellow-500',
    error: 'bg-red-500',
  }[type];

  return (
    <div className={`fixed top-4 right-4 z-50 p-4 rounded-lg text-white ${bgColor}`}>
      <div className="flex items-center justify-between">
        <span>{message}</span>
        <button onClick={onClose} className="ml-4 text-white hover:text-gray-200">
          Ã—
        </button>
      </div>
    </div>
  );
}
```

---

## ğŸ”Œ API ì„¤ê³„ ìƒì„¸

### RESTful API ì„¤ê³„ ì›ì¹™

```typescript
// API ì‘ë‹µ í‘œì¤€ í˜•ì‹
interface ApiResponse<T = any> {
	success: boolean
	message: string
	data?: T
	error?: string
}

// í˜ì´ì§• ì‘ë‹µ í˜•ì‹
interface PaginatedResponse<T> {
	success: boolean
	message: string
	data: {
		items: T[]
		totalCount: number
		currentPage: number
		pageSize: number
		totalPages: number
	}
}
```

### ì»¨íŠ¸ë¡¤ëŸ¬ ì„¤ê³„ íŒ¨í„´

```typescript
// employee.controller.ts
@Controller('employee')
export class EmployeeController {
	constructor(private readonly employeeService: EmployeeService) {}

	@Post('search')
	@ApiOperation({
		summary: 'ì§ì› ê²€ìƒ‰',
		description: 'ì‚¬ì›(ì§ì›)ì„ ê²€ìƒ‰í•˜ê³  í”„ë¡œì‹œì € ì •ë³´ë¥¼ í¬í•¨í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.',
	})
	@ApiBody({ type: EmployeeSearchParams })
	@ApiResponse({
		status: 200,
		description: 'ì§ì› ê²€ìƒ‰ ì„±ê³µ',
		type: EmployeeSearchResponseDto,
	})
	async searchEmployees(
		@Body() body: EmployeeSearchParams
	): Promise<EmployeeSearchResponseDto> {
		return this.employeeService.searchEmployees(body)
	}
}
```

### DTO (Data Transfer Object) ì„¤ê³„

```typescript
// dto/employee.dto.ts
export class EmployeeSearchParams {
	@ApiProperty({ description: 'ê²€ìƒ‰ í‚¤ì›Œë“œ' })
	kb?: string

	@ApiProperty({ description: 'ì‚¬ì›ë²ˆí˜¸' })
	empNo?: string

	@ApiProperty({ description: 'ì‚¬ì›ëª…' })
	empNm?: string

	@ApiProperty({ description: 'ë‚´ë¶€/ì™¸ë¶€ êµ¬ë¶„' })
	ownOutsDiv?: string

	@ApiProperty({ description: 'í‡´ì§ ì—¬ë¶€' })
	retirYn?: string
}

export class EmployeeSearchResponseDto {
	@ApiProperty({ description: 'ì„±ê³µ ì—¬ë¶€' })
	success: boolean

	@ApiProperty({ description: 'ì‘ë‹µ ë©”ì‹œì§€' })
	message: string

	@ApiProperty({ description: 'ì§ì› ëª©ë¡', type: [Employee] })
	data: Employee[]

	@ApiProperty({ description: 'í”„ë¡œì‹œì € ì •ë³´' })
	procedureInfo: any
}
```

### ì—ëŸ¬ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´

```typescript
// common/error-handler.ts
@Catch()
export class GlobalExceptionFilter implements ExceptionFilter {
	catch(exception: unknown, host: ArgumentsHost) {
		const ctx = host.switchToHttp()
		const response = ctx.getResponse<Response>()
		const request = ctx.getRequest<Request>()

		let status = HttpStatus.INTERNAL_SERVER_ERROR
		let message = 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'

		if (exception instanceof HttpException) {
			status = exception.getStatus()
			message = exception.message
		} else if (exception instanceof Error) {
			message = exception.message
		}

		const errorResponse = {
			success: false,
			message,
			timestamp: new Date().toISOString(),
			path: request.url,
		}

		response.status(status).json(errorResponse)
	}
}
```

---

## âš¡ ì„±ëŠ¥ ìµœì í™”

### í”„ë¡ íŠ¸ì—”ë“œ ìµœì í™”

#### 1. ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…

```typescript
// ë™ì  ì„í¬íŠ¸ë¥¼ í†µí•œ ì»´í¬ë„ŒíŠ¸ ë¡œë”©
const loadComponent = async (menuPath: string) => {
	try {
		const module = await import(`../${menuPath}`)
		return module.default
	} catch (error) {
		console.error('Component load error:', error)
		throw error
	}
}
```

#### 2. ë©”ëª¨ì´ì œì´ì…˜

```typescript
// React.memoë¥¼ í†µí•œ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
const MenuTree = React.memo(({ menuList, onMenuClick }: MenuTreeProps) => {
  return (
    <div className="menu-tree">
      {menuList.map((menu) => (
        <MenuItem key={menu.menuSeq} menu={menu} onClick={onMenuClick} />
      ))}
    </div>
  );
});
```

#### 3. ê°€ìƒí™” (Virtualization)

```typescript
// AG Gridë¥¼ í†µí•œ ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬
import { AgGridReact } from 'ag-grid-react';

const DataGrid = ({ data }: { data: any[] }) => {
  const columnDefs = [
    { field: 'empNo', headerName: 'ì‚¬ì›ë²ˆí˜¸' },
    { field: 'empNm', headerName: 'ì‚¬ì›ëª…' },
    { field: 'deptNm', headerName: 'ë¶€ì„œëª…' },
  ];

  return (
    <div className="ag-theme-alpine" style={{ height: 400 }}>
      <AgGridReact
        rowData={data}
        columnDefs={columnDefs}
        pagination={true}
        paginationPageSize={50}
        rowSelection="single"
        animateRows={true}
      />
    </div>
  );
};
```

### ë°±ì—”ë“œ ìµœì í™”

#### 1. ì»¤ë„¥ì…˜ í’€ ê´€ë¦¬

```typescript
// Oracle ì»¤ë„¥ì…˜ í’€ ìµœì í™”
const poolConfig = {
	user: process.env.DB_USER,
	password: process.env.DB_PASSWORD,
	connectString: `${process.env.DB_HOST}:${process.env.DB_PORT}/${process.env.DB_SERVICE}`,
	poolMin: 2, // ìµœì†Œ ì—°ê²° ìˆ˜
	poolMax: 10, // ìµœëŒ€ ì—°ê²° ìˆ˜
	poolIncrement: 1, // ì—°ê²° ì¦ê°€ ë‹¨ìœ„
	poolTimeout: 60, // ì—°ê²° íƒ€ì„ì•„ì›ƒ (ì´ˆ)
	queueTimeout: 60000, // í íƒ€ì„ì•„ì›ƒ (ë°€ë¦¬ì´ˆ)
}
```

#### 2. ìºì‹± ì „ëµ

```typescript
// ë©”ë‰´ ë°ì´í„° ìºì‹±
@Injectable()
export class MenuService {
	private menuCache = new Map<string, any[]>()
	private cacheTimeout = 5 * 60 * 1000 // 5ë¶„

	async getMenuListByRole(roleId: string): Promise<any[]> {
		const cacheKey = `menu_${roleId}`
		const cached = this.menuCache.get(cacheKey)

		if (cached && Date.now() - cached.timestamp < this.cacheTimeout) {
			return cached.data
		}

		const menuList = await this.executeMenuQuery(roleId)
		this.menuCache.set(cacheKey, {
			data: menuList,
			timestamp: Date.now(),
		})

		return menuList
	}
}
```

#### 3. ë°°ì¹˜ ì²˜ë¦¬

```typescript
// ëŒ€ìš©ëŸ‰ ë°ì´í„° ë°°ì¹˜ ì²˜ë¦¬
async processBatchData(data: any[], batchSize: number = 100) {
  const batches = [];
  for (let i = 0; i < data.length; i += batchSize) {
    batches.push(data.slice(i, i + batchSize));
  }

  for (const batch of batches) {
    await this.processBatch(batch);
  }
}
```

---

## ğŸ”’ ë³´ì•ˆ êµ¬í˜„ ìƒì„¸

### ì„¸ì…˜ ë³´ì•ˆ ì„¤ì •

```typescript
// main.ts - ì„¸ì…˜ ë³´ì•ˆ ì„¤ì •
app.use(
	session({
		secret: process.env.SESSION_SECRET || 'bist-secret',
		resave: false,
		saveUninitialized: false,
		cookie: {
			httpOnly: true, // XSS ê³µê²© ë°©ì§€
			secure: process.env.NODE_ENV === 'production', // HTTPS í™˜ê²½ì—ì„œë§Œ ì „ì†¡
			sameSite: 'lax', // CSRF ê³µê²© ë°©ì§€
			path: '/',
			maxAge: 1000 * 60 * 60 * 24, // 24ì‹œê°„
		},
		name: 'bist-session', // ê¸°ë³¸ ì„¸ì…˜ëª… ë³€ê²½
	})
)
```

### ì…ë ¥ ê²€ì¦

```typescript
// DTO ê²€ì¦
export class LoginDto {
  @IsString()
  @IsNotEmpty({ message: 'ì‚¬ì›ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' })
  @Length(1, 10, { message: 'ì‚¬ì›ë²ˆí˜¸ëŠ” 1-10ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤.' })
  empNo: string;

  @IsString()
  @IsNotEmpty({ message: 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' })
  @Length(1, 20, { message: 'ë¹„ë°€ë²ˆí˜¸ëŠ” 1-20ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤.' })
  password: string;
}

// ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ê²€ì¦ ì ìš©
@Post('login')
async login(@Body() loginDto: LoginDto, @Req() req: RequestWithSession) {
  // ê²€ì¦ì€ ìë™ìœ¼ë¡œ ìˆ˜í–‰ë¨
  const { empNo, password } = loginDto;
  // ... ë¡œê·¸ì¸ ë¡œì§
}
```

### SQL ì¸ì ì…˜ ë°©ì§€

```typescript
// í”„ë¡œì‹œì € ì‹¤í–‰ ì‹œ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©
async executeProcedure(procedureName: string, params: any[] = []): Promise<any> {
  const connection = await this.getConnection();

  try {
    const bindVars: any = {
      o_result: { type: oracledb.CURSOR, dir: oracledb.BIND_OUT },
    };

    // íŒŒë¼ë¯¸í„°ë¥¼ ë°”ì¸ë”©í•˜ì—¬ SQL ì¸ì ì…˜ ë°©ì§€
    params.forEach((param, i) => {
      bindVars[`p${i + 1}`] = param;
    });

    const result = await connection.execute(
      `BEGIN ${procedureName}(:o_result${params.length > 0 ? ', ' + params.map((_, i) => `:p${i + 1}`).join(', ') : ''}); END;`,
      bindVars,
      { outFormat: oracledb.OUT_FORMAT_OBJECT }
    );

    return result;
  } finally {
    await connection.close();
  }
}
```

### CORS ì„¤ì •

```typescript
// CORS ë³´ì•ˆ ì„¤ì •
app.enableCors({
	origin: process.env.ALLOWED_ORIGINS?.split(',') || ['http://localhost:3000'],
	credentials: true,
	methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
	allowedHeaders: ['Content-Type', 'Authorization'],
	exposedHeaders: ['Set-Cookie'],
})
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì „ëµ

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

```typescript
// auth.service.spec.ts
describe('AuthService', () => {
	let service: AuthService
	let userService: UserService
	let menuService: MenuService

	beforeEach(async () => {
		const module: TestingModule = await Test.createTestingModule({
			providers: [
				AuthService,
				{
					provide: UserService,
					useValue: {
						userExists: jest.fn(),
						validateUserPassword: jest.fn(),
						findUserWithDept: jest.fn(),
					},
				},
				{
					provide: MenuService,
					useValue: {
						getMenuListByRole: jest.fn(),
					},
				},
			],
		}).compile()

		service = module.get<AuthService>(AuthService)
		userService = module.get<UserService>(UserService)
		menuService = module.get<MenuService>(MenuService)
	})

	it('should be defined', () => {
		expect(service).toBeDefined()
	})

	describe('login', () => {
		it('should return success when valid credentials provided', async () => {
			const mockUser = { userId: 'test', userName: 'Test User' }
			jest.spyOn(userService, 'userExists').mockResolvedValue(true)
			jest.spyOn(userService, 'validateUserPassword').mockResolvedValue(true)
			jest.spyOn(userService, 'findUserWithDept').mockResolvedValue(mockUser)
			jest.spyOn(menuService, 'getMenuListByRole').mockResolvedValue([])

			const result = await service.login('test', 'password')
			expect(result.success).toBe(true)
		})
	})
})
```

### í†µí•© í…ŒìŠ¤íŠ¸

```typescript
// auth.e2e-spec.ts
describe('AuthController (e2e)', () => {
	let app: INestApplication

	beforeEach(async () => {
		const moduleFixture: TestingModule = await Test.createTestingModule({
			imports: [AppModule],
		}).compile()

		app = moduleFixture.createNestApplication()
		await app.init()
	})

	it('/auth/login (POST)', () => {
		return request(app.getHttpServer())
			.post('/auth/login')
			.send({ empNo: 'test', password: 'test' })
			.expect(200)
			.expect((res) => {
				expect(res.body).toHaveProperty('success')
			})
	})

	afterAll(async () => {
		await app.close()
	})
})
```

### í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸

```typescript
// useAuth.test.ts
import { renderHook, act } from '@testing-library/react'
import { useAuth } from './useAuth'

describe('useAuth', () => {
	it('should provide authentication state', () => {
		const { result } = renderHook(() => useAuth())

		expect(result.current).toHaveProperty('user')
		expect(result.current).toHaveProperty('isAuthenticated')
		expect(result.current).toHaveProperty('login')
		expect(result.current).toHaveProperty('logout')
	})
})
```

---

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### ë¡œê¹… ì „ëµ

```typescript
// utils/logger.ts
import { Logger } from '@nestjs/common'

export class AppLogger extends Logger {
	log(message: string, context?: string) {
		super.log(`[${new Date().toISOString()}] ${message}`, context)
	}

	error(message: string, trace?: string, context?: string) {
		super.error(`[${new Date().toISOString()}] ${message}`, trace, context)
	}

	warn(message: string, context?: string) {
		super.warn(`[${new Date().toISOString()}] ${message}`, context)
	}
}

// ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì‚¬ìš©
@Controller('auth')
export class AuthController {
	private readonly logger = new AppLogger(AuthController.name)

	@Post('login')
	async login(@Body() body: any) {
		this.logger.log(`ë¡œê·¸ì¸ ì‹œë„: ${body.empNo}`)

		try {
			// ë¡œê·¸ì¸ ë¡œì§
			this.logger.log(`ë¡œê·¸ì¸ ì„±ê³µ: ${body.empNo}`)
		} catch (error) {
			this.logger.error(`ë¡œê·¸ì¸ ì‹¤íŒ¨: ${body.empNo}`, error.stack)
			throw error
		}
	}
}
```

### ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

```typescript
// interceptors/performance.interceptor.ts
@Injectable()
export class PerformanceInterceptor implements NestInterceptor {
	intercept(context: ExecutionContext, next: CallHandler): Observable<any> {
		const start = Date.now()
		const request = context.switchToHttp().getRequest()

		return next.handle().pipe(
			tap(() => {
				const duration = Date.now() - start
				console.log(`${request.method} ${request.url} - ${duration}ms`)

				// ì„±ëŠ¥ ì„ê³„ê°’ ì´ˆê³¼ ì‹œ ê²½ê³ 
				if (duration > 1000) {
					console.warn(
						`Slow API call: ${request.method} ${request.url} - ${duration}ms`
					)
				}
			})
		)
	}
}
```

### í—¬ìŠ¤ ì²´í¬

```typescript
// health/health.controller.ts
@Controller('health')
export class HealthController {
	constructor(private readonly oracleService: OracleService) {}

	@Get()
	async check() {
		const dbStatus = this.oracleService.isConnected()

		return {
			status: dbStatus ? 'healthy' : 'unhealthy',
			timestamp: new Date().toISOString(),
			database: {
				status: dbStatus ? 'connected' : 'disconnected',
			},
			uptime: process.uptime(),
			memory: process.memoryUsage(),
		}
	}
}
```

---

## ğŸ“š ê²°ë¡ 

BIST_NEW í”„ë¡œì íŠ¸ëŠ” í˜„ëŒ€ì ì¸ ì›¹ ê°œë°œ ê¸°ìˆ ì„ í™œìš©í•˜ì—¬ ê¸°ì¡´ ë ˆê±°ì‹œ ì‹œìŠ¤í…œì„ ì„±ê³µì ìœ¼ë¡œ í˜„ëŒ€í™”í•œ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

### ì£¼ìš” ì„±ê³¼

1. **ëª¨ë…¸ë ˆí¬ êµ¬ì¡°**: Turborepoë¥¼ í†µí•œ íš¨ìœ¨ì ì¸ í”„ë¡œì íŠ¸ ê´€ë¦¬
2. **íƒ€ì… ì•ˆì „ì„±**: TypeScriptë¥¼ í†µí•œ ì—”ë“œ-íˆ¬-ì—”ë“œ íƒ€ì… ì•ˆì „ì„± í™•ë³´
3. **ëª¨ë“ˆí™” ì„¤ê³„**: ê¸°ëŠ¥ë³„ ëª¨ë“ˆ ë¶„ë¦¬ë¡œ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
4. **ë³´ì•ˆ ê°•í™”**: ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦ ë° ì…ë ¥ ê²€ì¦ ê°•í™”
5. **ì„±ëŠ¥ ìµœì í™”**: ì½”ë“œ ìŠ¤í”Œë¦¬íŒ… ë° ì»¤ë„¥ì…˜ í’€ ê´€ë¦¬

### í–¥í›„ ê°œì„  ë°©í–¥

1. **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ í™•ëŒ€**: ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸ ì¶”ê°€
2. **ëª¨ë‹ˆí„°ë§ ê°•í™”**: APM ë„êµ¬ ë„ì…
3. **CI/CD íŒŒì´í”„ë¼ì¸**: ìë™í™”ëœ ë°°í¬ í”„ë¡œì„¸ìŠ¤ êµ¬ì¶•
4. **ë¬¸ì„œí™” ê°œì„ **: API ë¬¸ì„œ ìë™í™”

ì´ ë¬¸ì„œëŠ” BIST_NEW í”„ë¡œì íŠ¸ì˜ ê¸°ìˆ ì  êµ¬í˜„ ì„¸ë¶€ì‚¬í•­ì„ ë‹´ê³  ìˆìœ¼ë©°, ìƒˆë¡œìš´ íŒ€ì›ì˜ ë¹ ë¥¸ ì ì‘ê³¼ í”„ë¡œì íŠ¸ì˜ ì„±ê³µì ì¸ ìœ ì§€ë³´ìˆ˜ë¥¼ ìœ„í•œ ê°€ì´ë“œ ì—­í• ì„ í•©ë‹ˆë‹¤.
