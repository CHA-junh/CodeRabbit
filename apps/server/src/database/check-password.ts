import * as oracledb from 'oracledb';
import * as dotenv from 'dotenv';

dotenv.config();

async function checkPassword() {
  let connection: oracledb.Connection | null = null;

  try {
    console.log('ğŸ”Œ DB ì—°ê²° ì‹œë„ ì¤‘...');

    connection = await oracledb.getConnection({
      user: process.env.DB_USER,
      password: process.env.DB_PASSWORD,
      connectString: `${process.env.DB_HOST}:${process.env.DB_PORT}/${process.env.DB_SERVICE}`,
    });

    console.log('âœ… DB ì—°ê²° ì„±ê³µ!');

    const userId = '10529';

    console.log(`\nğŸ” ì‚¬ìš©ì ${userId} ì •ë³´ í™•ì¸:`);

    // ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
    const userResult = await connection.execute(
      'SELECT USER_ID, USER_NM, USER_PWD FROM TBL_USER_INF WHERE USER_ID = :userId',
      [userId],
    );

    if (userResult.rows && userResult.rows.length > 0) {
      const userData = userResult.rows[0] as any[];
      console.log('â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”');
      console.log('â”‚ í•­ëª©         â”‚ ê°’                                 â”‚');
      console.log('â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤');
      console.log(`â”‚ ì‚¬ë²ˆ         â”‚ ${userData[0]}                    â”‚`);
      console.log(`â”‚ ì´ë¦„         â”‚ ${userData[1] || 'N/A'}           â”‚`);
      console.log(`â”‚ ë¹„ë°€ë²ˆí˜¸     â”‚ ${userData[2] || 'N/A'}           â”‚`);
      console.log('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜');
    } else {
      console.log('âŒ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
  } catch (error) {
    console.error('âŒ í™•ì¸ ì‹¤íŒ¨:', error);
  } finally {
    if (connection) {
      try {
        await connection.close();
        console.log('\nğŸ”Œ DB ì—°ê²° ì¢…ë£Œ');
      } catch (error) {
        console.error('âŒ ì—°ê²° ì¢…ë£Œ ì‹¤íŒ¨:', error);
      }
    }
  }
}

// ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
if (require.main === module) {
  checkPassword()
    .then(() => {
      console.log('\nâœ… ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì™„ë£Œ');
      process.exit(0);
    })
    .catch((error) => {
      console.error('\nâŒ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹¤íŒ¨:', error);
      process.exit(1);
    });
}

export { checkPassword };
